{
    "filepath": "./src/paddock_parser/backtester.py",
    "content": "from typing import List, Callable, Dict, Any\nfrom .database.manager import DatabaseManager\nfrom .models import Race\n\nclass Backtester:\n    \"\"\"\n    A class to backtest scoring strategies against historical race data.\n    \"\"\"\n    def __init__(self, db_manager: DatabaseManager):\n        \"\"\"Initializes the Backtester with a DatabaseManager instance.\"\"\"\n        self.db_manager = db_manager\n\n    def run(self, strategy_func: Callable[[List[Race]], List[Race]]) -> Dict[str, Any]:\n        \"\"\"\n        Runs a given strategy function against historical data and calculates performance.\n        \"\"\"\n        # 1. Fetch all historical races from the database\n        historical_races = self.db_manager.get_all_races()\n\n        # 2. Handle the case where there is no historical data\n        if not historical_races:\n            return {\n                \"bets_placed\": 0,\n                \"winners_found\": 0,\n                \"win_rate\": 0.0,\n            }\n\n        # 3. Apply the selection strategy to the historical data\n        # The strategy function should return the races with the \"picked\" runner\n        # at index 0 of the runners list.\n        races_with_picks = strategy_func(historical_races)\n\n        # 4. Analyze the results\n        bets_placed = 0\n        winners_found = 0\n\n        for race in races_with_picks:\n            bets_placed += 1\n\n            # Check if the strategy made a pick (i.e., there's at least one runner)\n            if race.runners:\n                picked_runner = race.runners[0]\n\n                # Check if the picked runner was the actual winner\n                if picked_runner.is_winner:\n                    winners_found += 1\n\n        # 5. Calculate the final win rate\n        win_rate = (winners_found / bets_placed) * 100 if bets_placed > 0 else 0.0\n\n        # 6. Return the performance results\n        return {\n            \"bets_placed\": bets_placed,\n            \"winners_found\": winners_found,\n            \"win_rate\": win_rate,\n        }\n"
}