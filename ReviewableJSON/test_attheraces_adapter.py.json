{
    "filepath": "./tests/adapters/test_attheraces_adapter.py",
    "content": "import pytest\nfrom datetime import datetime\n\nfrom paddock_parser.adapters.attheraces_adapter import AtTheRacesAdapter\nfrom paddock_parser.base import NormalizedRace, NormalizedRunner\n\n@pytest.fixture\ndef real_attheraces_html():\n    \"\"\"\n    Fixture providing actual At The Races HTML structure.\n    Based on https://www.attheraces.com/racecard/Roscommon/01-September-2025/1745\n    \"\"\"\n    return \"\"\"\n    <!DOCTYPE html>\n    <html>\n    <body>\n        <div class=\"race-header\"><h1>17:45 Roscommon (IRE) 01 Sep 2025</h1><div class=\"race-info\"><div>Lecarrow Race</div></div></div>\n        <div class=\"runner-card\" data-horse=\"In My Teens\"><div class=\"runner-info\"><div class=\"horse-name\"><a>In My Teens</a></div><div class=\"runner-number\">72</div><div class=\"connections\"><div class=\"jockey\">J: G F Carroll</div><div class=\"trainer\">T: G P Cromwell</div></div><div class=\"odds\">7/2</div></div></div>\n        <div class=\"runner-card\" data-horse=\"Vorfreude\"><div class=\"runner-info\"><div class=\"horse-name\"><a>Vorfreude</a></div><div class=\"runner-number\">11</div><div class=\"connections\"><div class=\"jockey\">J: B M Coen</div><div class=\"trainer\">T: J G Murphy</div></div><div class=\"odds\">11/4</div></div></div>\n    </body>\n    </html>\n    \"\"\"\n\ndef test_parse_races_extracts_correct_data(real_attheraces_html):\n    \"\"\"\n    Tests that the adapter correctly parses the HTML and extracts all runner and race data.\n    \"\"\"\n    adapter = AtTheRacesAdapter()\n    races = adapter.parse_races(real_attheraces_html)\n\n    assert len(races) == 1\n    race = races[0]\n\n    assert race.track_name == \"Roscommon (IRE)\"\n    assert race.post_time == datetime(2025, 9, 1, 17, 45)\n    assert race.race_type == \"Lecarrow Race\"\n    assert race.number_of_runners == 2\n\n    assert len(race.runners) == 2\n    \n    in_my_teens = race.runners[0]\n    assert in_my_teens.name == \"In My Teens\"\n    assert in_my_teens.program_number == 72\n    assert in_my_teens.jockey == \"G F Carroll\"\n    assert in_my_teens.trainer == \"G P Cromwell\"\n    assert in_my_teens.odds == 4.5 # 7/2 + 1\n\n    vorfreude = race.runners[1]\n    assert vorfreude.name == \"Vorfreude\"\n    assert vorfreude.program_number == 11\n    assert vorfreude.jockey == \"B M Coen\"\n    assert vorfreude.trainer == \"J G Murphy\"\n    assert vorfreude.odds == 3.75 # 11/4 + 1\n"
}